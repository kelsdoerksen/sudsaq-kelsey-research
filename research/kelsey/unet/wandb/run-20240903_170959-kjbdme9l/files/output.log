/Users/kelseydoerksen/opt/anaconda3/envs/aq/lib/python3.10/site-packages/torch/cuda/amp/grad_scaler.py:120: UserWarning: torch.cuda.amp.GradScaler is enabled, but CUDA is not available.  Disabling.
  warnings.warn("torch.cuda.amp.GradScaler is enabled, but CUDA is not available.  Disabling.")
Grabbing training data...
Grabbing testing data...
Training EPOCH 0:
quantiles_train Quantile loss is: 53.94635327657064
test set loss is: 39.45372772216797
Quantile Regression Coverage without conformal is: 0.0029998500074995826
Predicting on calibration set...
test set loss is: 40.885066986083984
Calculating qyhat for calibration...
> /Users/kelseydoerksen/code/sudsaq-kelsey-research/research/kelsey/unet/run_cqr.py(210)calibrate_qyhat()
    209         ipdb.set_trace()
--> 210         low = low[y_mask[0][i][0]]
    211         low_list = list(low.flatten())
[tensor([[[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        ...,
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]]]), tensor([[[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        ...,
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]]]), tensor([[[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        ...,
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]]]), tensor([[[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        ...,
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]]]), tensor([[[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        ...,
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]]]), tensor([[[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        ...,
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]]]), tensor([[[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        ...,
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]],
        [[[False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          [False, False, False,  ..., False, False, False],
          ...,
          [False, False, False,  ..., False, False, False],
          [False, False,  True,  ..., False, False, False],
          [False, False, False,  ..., False, False, False]]]])]
*** AttributeError: 'list' object has no attribute 'shape'
7
torch.Size([32, 1, 31, 49])
tensor([[[False, False, False,  ..., False, False, False],
         [False, False, False,  ..., False, False, False],
         [False, False, False,  ..., False, False, False],
         ...,
         [False, False, False,  ..., False, False, False],
         [False, False,  True,  ..., False, False, False],
         [False, False, False,  ..., False, False, False]]])
torch.Size([1, 31, 49])
(32, 31, 49)
*** IndexError: boolean index did not match indexed array along dimension 0; dimension is 32 but corresponding boolean dimension is 1
32
(31, 49)
array([0.7002353 , 0.68561274, 0.6429124 , 0.6396101 , 0.6837378 ,
       0.6828647 , 0.666178  , 0.85256624, 0.7496594 , 0.73545325,
       0.7108718 , 0.78022337, 0.9476038 , 0.9456978 , 0.8927202 ,
       0.804056  , 0.7963875 , 0.74398845, 0.9938533 , 1.024754  ,
       1.0167696 , 0.97967577, 0.9389657 , 0.89196384, 0.86664766,
       0.84011084, 0.8315375 , 0.82323396, 0.82122976, 0.8233425 ,
       0.8365187 , 0.8514351 , 0.8580452 , 0.8434423 , 0.7085087 ,
       0.712152  , 0.9014347 , 0.8445839 , 0.86360925, 0.897     ,
       0.925354  , 0.87385046, 0.8838548 , 0.8611563 , 0.8083851 ,
       0.73614013, 0.72931546, 0.73011976, 0.72099847, 0.73035854,
       0.76396275, 0.8039635 , 1.0376809 , 1.082965  , 1.090236  ,
       1.0676044 , 1.0311506 , 0.93921673, 0.9101664 , 0.87535274,
       0.8908721 , 0.903609  , 0.94575346, 1.0316186 , 0.9732643 ,
       0.876261  , 0.8576096 , 0.8986986 , 0.89394957, 0.84252864,
       0.8029963 , 0.7445601 , 0.72812337, 1.0586615 , 1.100222  ,
       1.0504141 , 0.9343499 , 0.90148306, 0.895827  , 0.90446585,
       0.9194892 , 0.9836282 , 1.0630606 , 1.0899638 , 1.0446028 ,
       0.94067585, 0.74641675, 0.8203521 , 0.87542605, 0.8850896 ,
       0.7588843 , 0.7352178 , 0.7394881 , 0.980621  , 1.0433375 ,
       1.1149665 , 1.1696123 , 1.128633  , 0.984633  , 0.93362683,
       0.9063981 , 0.9260799 , 0.9616758 , 1.0089111 , 1.0506836 ,
       1.1081152 , 1.1426833 , 1.0852605 , 1.0125761 , 0.9443499 ,
       0.86119825, 0.7948282 , 0.84018314, 0.8558975 , 0.84717625,
       0.8020254 , 0.73018694, 0.7248943 , 0.9661813 , 1.0389118 ,
       1.126077  , 1.2084705 , 1.2062198 , 0.98869956, 0.9783908 ,
       1.0095295 , 1.086745  , 1.147209  , 1.14291   , 1.1174943 ,
       1.060291  , 1.0191205 , 0.9436272 , 0.712889  , 0.7708595 ,
       0.81274414, 0.8050315 , 0.8000681 , 0.77208465, 0.7468926 ,
       0.7202051 , 0.72113144, 0.99679565, 1.1916903 , 1.2261125 ,
       1.0071338 , 1.0175732 , 1.0630674 , 1.0970336 , 1.1273444 ,
       1.1641896 , 1.167936  , 1.1701919 , 1.0791917 , 1.0217932 ,
       0.930101  , 0.55960625, 0.6757257 , 0.7256115 , 0.74866337,
       0.722645  , 0.9530468 , 1.1552348 , 1.1981547 , 1.0689446 ,
       1.0309066 , 1.0173115 , 1.0375693 , 1.0727209 , 1.093096  ,
       1.1734763 , 1.1965133 , 1.2179393 , 1.2195425 , 1.1833482 ,
       1.0871737 , 0.988971  , 0.5229398 , 0.63016033, 0.68113786,
       0.69772786, 0.71183205, 0.7757752 , 0.7049412 , 0.71688414,
       0.76665866, 0.99362284, 1.0732516 , 1.1125929 , 1.0729634 ,
       1.0406065 , 1.012585  , 1.0081897 , 1.0229952 , 1.055992  ,
       1.0760555 , 1.1204283 , 1.2101177 , 1.2341448 , 1.2746279 ,
       1.2804002 , 1.224524  , 1.0464959 , 0.8961097 , 0.5796842 ,
       0.6244559 , 0.7848486 , 0.7149291 , 0.99215424, 0.9779311 ,
       0.9787046 , 1.0302373 , 1.0557084 , 1.102447  , 1.1572981 ,
       1.2286965 , 1.2931209 , 1.2858335 , 1.2612181 , 1.2195754 ,
       1.1109817 , 0.9860314 , 0.75888276, 0.5191936 , 0.3370091 ,
       0.4534395 , 0.7730161 , 0.69631755, 0.7094833 , 0.9107006 ,
       0.9457462 , 0.9626071 , 0.96308565, 0.96312404, 0.95713407,
       0.96944505, 0.9940048 , 1.0107977 , 1.0762902 , 1.2150698 ,
       1.254344  , 1.2765696 , 1.2574663 , 1.1895539 , 1.0861577 ,
       1.0289644 , 0.8170569 , 0.50867605, 0.2654381 , 0.43156374,
       0.7091793 , 0.93672   , 0.93453443, 0.921447  , 0.92910385,
       0.9406358 , 0.92702746, 0.93082577, 0.9647015 , 1.0323029 ,
       1.0996845 , 1.1814579 , 1.2095097 , 1.1881084 , 1.1444852 ,
       1.0559645 , 0.9434357 , 0.7771999 , 0.5229117 , 0.26909557,
       0.42115733, 0.671508  , 0.68775535, 0.68249726, 0.69164276,
       0.8985259 , 0.9442336 , 0.9018065 , 0.88609886, 0.8668907 ,
       0.8506667 , 0.8530605 , 0.9262138 , 1.0084573 , 1.0633395 ,
       1.0884657 , 1.0973605 , 1.0739965 , 1.0344404 , 0.98350304,
       0.85992354, 0.7333981 , 0.48080653, 0.2614672 , 0.44433877,
       0.49197802, 0.65013987, 0.6591161 , 0.88022393, 0.9738725 ,
       0.95394784, 0.8687685 , 0.8369267 , 0.8061161 , 0.7897971 ,
       0.7748316 , 0.78604513, 0.9478459 , 0.9807892 , 0.9789384 ,
       0.94911194, 0.7651545 , 0.6285186 , 0.4343255 , 0.2409032 ,
       0.47819293, 0.5214882 , 0.52816415, 0.6094047 , 0.96271706,
       0.74778914, 0.7179289 , 0.69520634, 0.74892807, 0.8639632 ,
       0.8549755 , 0.76613176, 0.7181882 , 0.6023084 , 0.41994098,
       0.2234434 , 0.5400166 , 0.56467164, 0.59966666, 0.6081775 ,
       0.63602287, 0.8031161 , 0.87249583, 0.8424341 , 0.7837826 ,
       0.7263433 , 0.6594239 , 0.75925875, 0.6844998 , 0.38919792,
       0.20639531, 0.43058813, 0.57050997, 0.5889951 , 0.57468706,
       0.5518223 , 0.545635  , 0.52898294, 0.55715805, 0.7448653 ,
       0.6850235 , 0.6049016 , 0.68365854, 0.65816855, 0.1880105 ,
       0.46292326, 0.60293317, 0.62044555, 0.5737583 , 0.53301466,
       0.5386682 , 0.5292579 , 0.47314116, 0.5976449 , 0.70603836,
       0.65996313, 0.61692566, 0.52536297, 0.32500762, 0.20134667,
       0.5680884 , 0.5373248 , 0.4520232 , 0.4299748 , 0.4265275 ,
       0.44108242, 0.6501301 , 0.5492721 , 0.44708842, 0.39493582,
       0.36884135, 0.3559807 , 0.4381967 , 0.4463611 , 0.33321324,
       0.31144243, 0.26400182, 0.28328428, 0.20038383, 0.18813083,
       0.18129125, 0.13044922], dtype=float32)
Traceback (most recent call last):
  File "/Users/kelseydoerksen/code/sudsaq-kelsey-research/research/kelsey/unet/run_pipeline.py", line 136, in <module>
    run_cqr(unet, device, aq_train_dataset, aq_test_dataset, save_dir, experiment, 0.2, args.channels,
  File "/Users/kelseydoerksen/code/sudsaq-kelsey-research/research/kelsey/unet/run_cqr.py", line 285, in run_cqr
    qyhat = calibrate_qyhat(cal_loader, uncal_predictions_c, alpha)
  File "/Users/kelseydoerksen/code/sudsaq-kelsey-research/research/kelsey/unet/run_cqr.py", line 210, in calibrate_qyhat
    for j in range(len(low)):
  File "/Users/kelseydoerksen/code/sudsaq-kelsey-research/research/kelsey/unet/run_cqr.py", line 210, in calibrate_qyhat
    for j in range(len(low)):
  File "/Users/kelseydoerksen/opt/anaconda3/envs/aq/lib/python3.10/bdb.py", line 90, in trace_dispatch
    return self.dispatch_line(frame)
  File "/Users/kelseydoerksen/opt/anaconda3/envs/aq/lib/python3.10/bdb.py", line 115, in dispatch_line
    if self.quitting: raise BdbQuit
bdb.BdbQuit
If you suspect this is an IPython 8.7.0 bug, please report it at:
    https://github.com/ipython/ipython/issues
or send an email to the mailing list at ipython-dev@python.org
You can print a more detailed traceback right now with "%tb", or use "%debug"
to interactively debug it.
Extra-detailed tracebacks for bug-reporting purposes can be enabled via:
    %config Application.verbose_crash=True